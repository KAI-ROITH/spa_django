{% extends 'base.html' %}

{% block title %}Asset Dashboard{% endblock %}

{% block content %}
{% load static %}

<style>
    /* Remove any padding/margin from main content area */
    main {
        padding: 0 !important;
        margin: 0 !important;
    }
</style>

<!-- Full Screen Background Container -->
<div class="min-h-screen bg-cover bg-center bg-no-repeat relative" 
     style="background-image: url('{% static 'images/bg_megamart.jpg' %}'); background-attachment: fixed;">
    
    <!-- Dark Overlay for better readability -->
    <div class="absolute inset-0 bg-black bg-opacity-40"></div>
    
    <!-- Content -->
    <div class="relative z-10 container mx-auto px-4 py-8">
        
        <!-- Welcome Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">Asset Management Dashboard</h1>
            <p class="text-xl text-gray-200">Welcome back, {{ user.username }}!</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Assets Card -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6 transform hover:scale-105 transition duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium uppercase">Total Assets</p>
                        <p class="text-4xl font-bold text-blue-600 mt-2">{{ stats.total_assets }}</p>
                    </div>
                    <div class="bg-blue-100 rounded-full p-4">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Retail Assets Card -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6 transform hover:scale-105 transition duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium uppercase">Retail Assets</p>
                        <p class="text-4xl font-bold text-green-600 mt-2">{{ stats.retail_assets }}</p>
                        <a href="{% url 'retail_assets' %}" class="text-green-600 hover:text-green-800 text-sm font-medium mt-2 inline-block">
                            View All →
                        </a>
                    </div>
                    <div class="bg-green-100 rounded-full p-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- IT Assets Card -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6 transform hover:scale-105 transition duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium uppercase">IT Assets</p>
                        <p class="text-4xl font-bold text-yellow-600 mt-2">{{ stats.it_assets }}</p>
                        <a href="{% url 'it_assets' %}" class="text-yellow-600 hover:text-yellow-800 text-sm font-medium mt-2 inline-block">
                            View All →
                        </a>
                    </div>
                    <div class="bg-yellow-100 rounded-full p-4">
                        <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Network Assets Card -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6 transform hover:scale-105 transition duration-300">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium uppercase">Network Assets</p>
                        <p class="text-4xl font-bold text-purple-600 mt-2">{{ stats.network_assets }}</p>
                        <a href="{% url 'network_assets' %}" class="text-purple-600 hover:text-purple-800 text-sm font-medium mt-2 inline-block">
                            View All →
                        </a>
                    </div>
                    <div class="bg-purple-100 rounded-full p-4">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart and Quick Actions Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Pie Chart -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Assets Distribution</h3>
                <div class="flex items-center justify-center" style="height: 250px; max-width: 100%; overflow: hidden;">
                    {% if stats.total_assets > 0 %}
                        <div style="width: 250px; height: 250px;">
                            <canvas id="assetPieChart"></canvas>
                        </div>
                    {% else %}
                        <div class="text-center text-gray-500">
                            <svg class="w-16 h-16 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <p class="text-lg font-medium">No assets yet</p>
                            <p class="text-sm mt-1">Add your first asset to see the distribution</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white bg-opacity-95 backdrop-blur-sm rounded-lg shadow-xl p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Actions</h3>
                <div class="space-y-3">
                    <a href="{% url 'add_retail_asset' %}" 
                       class="block w-full bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-lg transition text-center font-medium">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add Retail Asset
                    </a>
                    <a href="{% url 'add_it_asset' %}" 
                       class="block w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-lg transition text-center font-medium">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add IT Asset
                    </a>
                    <a href="{% url 'cpu_assets' %}" 
                       class="block w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-4 rounded-lg transition text-center font-medium">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        View CPU Assets
                    </a>
                    <a href="{% url 'cctv_assets' %}" 
                       class="block w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-4 rounded-lg transition text-center font-medium">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        View CCTV Assets
                    </a>
                </div>
            </div>
        </div>

        <!-- Add some bottom spacing -->
        <div class="h-8"></div>
    </div>
</div>

<script>
    {% if stats.total_assets > 0 %}
    const labels = {{ labels|safe }};
    const data = {{ data|safe }};
    
    // Filter out zero values and their labels
    const filteredData = [];
    const filteredLabels = [];
    const colors = ['#10B981', '#3B82F6', '#9333EA'];
    const filteredColors = [];
    
    data.forEach((value, index) => {
        if (value > 0) {
            filteredData.push(value);
            filteredLabels.push(labels[index]);
            filteredColors.push(colors[index]);
        }
    });
    
    const ctx = document.getElementById('assetPieChart');
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: filteredLabels,
            datasets: [{
                data: filteredData,
                backgroundColor: filteredColors,
                borderWidth: 2,
                borderColor: '#ffffff',
                hoverOffset: 8,
                hoverBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            cutout: '60%',
            layout: {
                padding: 5
            },
            plugins: {
                title: {
                    display: false
                },
                legend: { 
                    position: 'bottom',
                    labels: { 
                        boxWidth: 12,
                        boxHeight: 12,
                        padding: 8,
                        font: { 
                            size: 11,
                            family: "'Inter', 'Segoe UI', sans-serif"
                        },
                        color: '#374151',
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 10,
                    bodyFont: {
                        size: 12
                    },
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            },
            animation: {
                animateRotate: true,
                animateScale: true,
                duration: 800
            }
        }
    });
    {% endif %}
</script>

{% endblock %}